# Computer Network-top down, Network layer

## Author PB18030980

## 基本功能：转发+路由选择

## 概述

### 基本概念

转发：单一的路由器从一条入链路到一条出链路的传送

路由选择：所有路由器，路由选择协议，决定目的主机到源主机的路径

数据报：网络层的分组

报文段：传输层的分组

选路：计算转发表

转发：根据转发表转运分组

### From different components of the Internet

#### 下一跳方法

路由表只保留吓一跳的地址

路由器保持一致

#### 发送方

* 网络层从运输层获取数据报
* 向相邻路由器发送

#### 接收方

* 网络层接收来自临近路由器的数据报
* 提取出运输层报文段
* 向上交付给目的主机的运输层

#### 路由器

* 数据报从输入链路转发到输出链路
* 路由器的协议栈是截断的，没有网络层以上的部分
* 分组交换机：根据分组首字段的值，从输入链路接口到输出链路接口转移分组
  * 链路层交换机：基于链路层首部字段分组
  * 路由器：根据网络层字段判断

### 转发与路由选择-网络层的基本功能

* 转发：输入链路到适当的输出链路
* 路由选择：分组从发送方流向接收方，网络层通过**路由选择算法**计算分区采用的路径/路由
* 转发指的是单个路由器的行为
* 路由选择是整个网络的行为
* 转发通过查阅转发表和分组首部字段实现
* 分组交换机：链路层交换机（根据链路层的值做决定）路由器（基于网络层的值做决定）

#### 连接建立

源主机到目的主机沿着选择的路径彼此握手

传输分组之前，两个**段系统**之间建立连接

网络层连接：主机-主机，连接状态保存在端系统和所有中间路由器上

### 网络服务模型

#### 网络层可以提供的基本服务

##### 对单个分组

* 保证交付
* 具有上界时延的保证交付

##### 可对分组流提供的服务

* 有序交付
* 保证最小带宽
* 保证最大时延抖动，时延差异尽量小

* 确保交付：确保分组到达目的地
  * 具有时延上界的确保交付，不仅要确保交付，而且要在时延之内交付
  * 有序分组交付
  * 确保最小带宽
* 确保最大时延抖动
* 安全性服务

#### Internet网络层提供的单一服务

尽力而为交付

#### ATM网络

* 多重服务模型：为不同的连接提供不同类型的服务
* 恒定比特率ATM服务：发送方和接收方之间存在一条专用的、固定带宽的传输链路，使用性质相同的虚拟管道提供分组
* 可用比特率ATM服务

## 虚电路和数据报网络

网络层的连接服务：需要握手 虚电路网络

网络层的非连接服务：不需要握手 数据报网络

### 虚电路网络

#### 网络中的面向连接和无连接服务

| 网络体系结构层次 | 面向连接 | 无连接 |
| ---------------- | -------- | ------ |
| 网络层           | 虚电路   | 数据报 |
| 传输层           | TCP      | UDP    |

**网络层的面向连接和无连接主要体现在做出转发决定时使用的信息**

#### 组成

* 源主机到目的主机的路径
* VC号，沿着该路径的每段链路的一个号码
* 沿着该路径每台路由器中的转发表表项，分组首部携带VC号
* 分组在首部增加VC号，每个路由器替换传输分组的VC号，新的VC号来自转发表

#### 路由器

* 转发表包含
  * 入接口
  * 出接口
  * 入VC号
  * 出VC号

**经过同一个入接口流入路由器的分组VC号不一定一样，这是入接口的复用**

* 创建一条新的虚电路，增加一个表项，删除一条虚电路，沿着路径删除所有表项
* 为何每条链路选择不同的VC号
  * 减少了首部段VC号的长度
  * 简化了虚电路的建立
* 连接状态信息

#### 虚电路三个阶段

* 虚电路建立：网络层确定路径，为每个链路确定一个VC号，在每个中间路由器转发表上增加一个表项，在虚电路建立期间，网络层要预留虚电路路径上的带宽
* 数据传输
* 虚电路拆除，发送方通知网络层终止虚电路，网络层通知端系统，更新转发表

指令报文：端系统向网络发送终止、启动连接的报文

### 数据报网络

最长前缀匹配原则减少转发表开销

### 数据报&&虚电路

## 路由器工作原理

### 硬件组成

* 输入端口：物理层物理链路和路由器相连
* 交换结构：在路由器中的网络
* 输出端口
* 处理器

### 输入端口

* 实现了输入端口的物理层和链路层
* 中央处理器只负责更新和推送转发表到输入输出端口

### 交换链路

* 经内存交换
* 经总线交换
* 经互联网络交换

### 输出端口

排队电路

### 排队与丢包

* 分组调度程度
* 放弃尾部